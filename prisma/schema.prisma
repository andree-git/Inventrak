generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model detalle_ventas {
  id              Int       @id @default(autoincrement())
  venta_id        Int
  producto_id     Int
  cantidad        Int
  precio_unitario Decimal   @db.Decimal(10, 2)
  subtotal        Decimal   @db.Decimal(10, 2)
  productos       productos @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_producto")
  ventas          ventas    @relation(fields: [venta_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_venta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model movimientos_inventario {
  id                Int       @id @default(autoincrement())
  producto_id       Int
  usuario_id        Int
  tipo_movimiento   String    @db.VarChar(20)
  cantidad          Int
  cantidad_anterior Int
  cantidad_nueva    Int
  fecha_movimiento  DateTime? @default(now()) @db.Timestamp(6)
  productos         productos @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_producto_mov")
  usuarios          usuarios  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_usuario_mov")
}

model productos {
  id                     Int                      @id @default(autoincrement())
  nombre                 String                   @db.VarChar(100)
  precio_venta           Decimal                  @db.Decimal(10, 2)
  precio_compra          Decimal                  @db.Decimal(10, 2)
  cantidad_actual        Int                      @default(0)
  cantidad_critica       Int                      @default(5)
  proveedor_id           Int?
  activo                 Boolean?                 @default(true)
  fecha_creacion         DateTime?                @default(now()) @db.Timestamp(6)
  detalle_ventas         detalle_ventas[]
  movimientos_inventario movimientos_inventario[]
  proveedores            proveedores?             @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_proveedor")
}

model proveedores {
  id             Int         @id @default(autoincrement())
  nombre         String      @db.VarChar(100)
  telefono       String?     @db.VarChar(20)
  email          String?     @db.VarChar(100)
  activo         Boolean?    @default(true)
  fecha_creacion DateTime?   @default(now()) @db.Timestamp(6)
  productos      productos[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model usuarios {
  id                     Int                      @id @default(autoincrement())
  usuario                String                   @unique @db.VarChar(50)
  password               String                   @db.VarChar(255)
  nombre                 String                   @db.VarChar(100)
  rol                    String                   @db.VarChar(20)
  activo                 Boolean?                 @default(true)
  fecha_creacion         DateTime?                @default(now()) @db.Timestamp(6)
  movimientos_inventario movimientos_inventario[]
  ventas                 ventas[]
}

model ventas {
  id             Int              @id @default(autoincrement())
  vendedor_id    Int
  fecha_venta    DateTime?        @default(now()) @db.Timestamp(6)
  total          Decimal          @db.Decimal(10, 2)
  detalle_ventas detalle_ventas[]
  usuarios       usuarios         @relation(fields: [vendedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_vendedor")
}
