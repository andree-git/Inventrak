generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                    Int                    @id @default(autoincrement())
  usuario               String                 @unique @db.VarChar(50)
  password              String                 @db.VarChar(255)
  nombre                String                 @db.VarChar(100)
  email                 String?                @db.VarChar(100)
  rol                   String                 @db.VarChar(20)
  activo                Boolean?               @default(true)
  fecha_creacion        DateTime?              @default(now()) @db.Timestamp(6)
  fecha_actualizacion   DateTime?              @default(now()) @updatedAt @db.Timestamp(6)
  movimientosInventario MovimientoInventario[]
  ventas                Venta[]

  @@map("usuarios")
}

model Proveedor {
  id             Int        @id @default(autoincrement())
  nombre         String     @db.VarChar(100)
  contacto       String?    @db.VarChar(100)
  telefono       String?    @db.VarChar(20)
  email          String?    @db.VarChar(100)
  direccion      String?
  activo         Boolean?   @default(true)
  fecha_creacion DateTime?  @default(now()) @db.Timestamp(6)
  productos      Producto[]

  @@map("proveedores")
}

model Producto {
  id                    Int                    @id @default(autoincrement())
  nombre                String                 @db.VarChar(100)
  descripcion           String?
  precio                Decimal                @db.Decimal(10, 2)
  proveedorId           Int?                   @map("proveedor_id")
  unidad                String                 @db.VarChar(10)
  cantidad_actual       Int?                   @default(0)
  cantidad_critica      Int?                   @default(5)
  activo                Boolean?               @default(true)
  fecha_creacion        DateTime?              @default(now()) @db.Timestamp(6)
  fecha_actualizacion   DateTime?              @default(now()) @updatedAt @db.Timestamp(6)
  detalleVentas         DetalleVenta[]
  movimientosInventario MovimientoInventario[]
  proveedor             Proveedor?             @relation(fields: [proveedorId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([proveedorId], map: "idx_productos_proveedor")
  @@map("productos")
}

model Venta {
  id            Int            @id @default(autoincrement())
  vendedorId    Int?           @map("vendedor_id")
  fecha_venta   DateTime?      @default(now()) @db.Timestamp(6)
  total         Decimal?       @default(0) @db.Decimal(10, 2)
  observaciones String?
  detalleVentas DetalleVenta[]
  vendedor      Usuario?       @relation(fields: [vendedorId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_venta], map: "idx_ventas_fecha")
  @@index([vendedorId], map: "idx_ventas_vendedor")
  @@map("ventas")
}

model DetalleVenta {
  id              Int       @id @default(autoincrement())
  ventaId         Int?      @map("venta_id")
  productoId      Int?      @map("producto_id")
  cantidad        Int
  precio_unitario Decimal   @db.Decimal(10, 2)
  subtotal        Decimal   @db.Decimal(10, 2)
  producto        Producto? @relation(fields: [productoId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  venta           Venta?    @relation(fields: [ventaId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([productoId], map: "idx_detalle_ventas_producto")
  @@index([ventaId], map: "idx_detalle_ventas_venta")
  @@map("detalle_ventas")
}

model MovimientoInventario {
  id                Int       @id @default(autoincrement())
  productoId        Int?      @map("producto_id")
  tipo_movimiento   String    @db.VarChar(20)
  cantidad          Int
  cantidad_anterior Int
  cantidad_nueva    Int
  motivo            String?   @db.VarChar(100)
  usuarioId         Int?      @map("usuario_id")
  fecha_movimiento  DateTime? @default(now()) @db.Timestamp(6)
  producto          Producto? @relation(fields: [productoId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  usuario           Usuario?  @relation(fields: [usuarioId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_movimiento], map: "idx_movimientos_fecha")
  @@index([productoId], map: "idx_movimientos_producto")
  @@map("movimientos_inventario")
}
